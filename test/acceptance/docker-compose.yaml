version: '3.8'

services:
  ffc-sfi-apply-web-acceptance-tests:
    build: .
    image: ffc-sfi-apply-web-acceptance-tests
    container_name: ffc-sfi-apply-web-acceptance-tests
    environment:
      BROWSERSTACK_ACCESS_KEY: ${BROWSERSTACK_ACCESS_KEY}
      BROWSERSTACK_USERNAME: ${BROWSERSTACK_USERNAME}
      CALCULATE_SUBSCRIPTION_ADDRESS: ${CALCULATE_SUBSCRIPTION_ADDRESS:-ffc-sfi-agreement-calculate-calculator}${MESSAGE_QUEUE_SUFFIX}
      CALCULATE_TOPIC_ADDRESS: ${CALCULATE_TOPIC_ADDRESS:-ffc-sfi-agreement-calculate}${MESSAGE_QUEUE_SUFFIX}
      CALCULATERESPONSE_QUEUE_ADDRESS: ${CALCULATERESPONSE_QUEUE_ADDRESS:-ffc-sfi-agreement-calculate-response}${MESSAGE_QUEUE_SUFFIX}
      AZURE_STORAGE_CONNECTION_STRING: ${AZURE_STORAGE_CONNECTION_STRING:-"DefaultEndpointsProtocol=http;AccountName=devstoreaccount1;AccountKey=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==;BlobEndpoint=http://ffc-sfi-apply-web-test-azurite:10000/devstoreaccount1;"}
      CHROME_ARGS: "--ignore-certificate-errors"
      ELIGIBILITY_SUBSCRIPTION_ADDRESS: ${ELIGIBILITY_SUBSCRIPTION_ADDRESS:-ffc-sfi-eligibility-check-calculator}${MESSAGE_QUEUE_SUFFIX}
      MESSAGE_QUEUE_HOST: ${MESSAGE_QUEUE_HOST}
      MESSAGE_QUEUE_PASSWORD: ${MESSAGE_QUEUE_PASSWORD}
      MESSAGE_QUEUE_USER: ${MESSAGE_QUEUE_USER}
      ELIGIBILITY_TOPIC_ADDRESS: ${ELIGIBILITY_TOPIC_ADDRESS:-ffc-sfi-eligibility-check}${MESSAGE_QUEUE_SUFFIX}
      ELIGIBILITYRESPONSE_QUEUE_ADDRESS: ${ELIGIBILITYRESPONSE_QUEUE_ADDRESS:-ffc-sfi-eligibility-check-response}${MESSAGE_QUEUE_SUFFIX}
      PARCELSPATIAL_TOPIC_ADDRESS: ${PARCELSPATIAL_TOPIC_ADDRESS:-ffc-sfi-parcel-spatial-request}${MESSAGE_QUEUE_SUFFIX}
      PARCELSPATIALRESPONSE_QUEUE_ADDRESS: ${PARCELSPATIALRESPONSE_QUEUE_ADDRESS:-ffc-sfi-parcel-spatial-response}${MESSAGE_QUEUE_SUFFIX}
      PARCELSTANDARD_TOPIC_ADDRESS: ${PARCELSTANDARD_TOPIC_ADDRESS:-ffc-sfi-parcel-standard-request}${MESSAGE_QUEUE_SUFFIX}
      PARCELSTANDARDRESPONSE_QUEUE_ADDRESS: ${PARCELSTANDARDRESPONSE_QUEUE_ADDRESS:-ffc-sfi-parcel-standard-response}${MESSAGE_QUEUE_SUFFIX}
      STANDARDS_TOPIC_ADDRESS: ${STANDARDS_TOPIC_ADDRESS:-ffc-sfi-standards-request}${MESSAGE_QUEUE_SUFFIX}
      STANDARDSRESPONSE_QUEUE_ADDRESS: ${STANDARDSRESPONSE_QUEUE_ADDRESS:-ffc-sfi-standards-request-response}${MESSAGE_QUEUE_SUFFIX}
      VALIDATE_TOPIC_ADDRESS: ${VALIDATE_TOPIC_ADDRESS:-ffc-sfi-agreement-validate}${MESSAGE_QUEUE_SUFFIX}
      SUBMIT_TOPIC_ADDRESS: ${SUBMIT_TOPIC_ADDRESS:-ffc-sfi-agreement-submit}${MESSAGE_QUEUE_SUFFIX}
      WITHDRAW_TOPIC_ADDRESS: ${WITHDRAW_TOPIC_ADDRESS:-ffc-sfi-agreement-withdraw}${MESSAGE_QUEUE_SUFFIX}
      PR_BUILD: ${PR_BUILD}
      STANDARDS_SUBSCRIPTION_ADDRESS: ${STANDARDS_SUBSCRIPTION_ADDRESS:-ffc-sfi-standards-request-calculator}${MESSAGE_QUEUE_SUFFIX}
      TEST_ENVIRONMENT_ROOT_URL: ${TEST_ENVIRONMENT_ROOT_URL}

  ffc-sfi-apply-web-test-azurite:
    image: mcr.microsoft.com/azure-storage/azurite
    ports:
      - "10007:10000"
    command: "azurite-blob --loose --blobHost 0.0.0.0"
    volumes:
      - azurite_data:/data
  mock-json-server:
    image: clue/json-server
    ports:
      - "10008:80"
    command: "--routes routes.json"
    volumes:
      - ./mocks/data:/data
networks:
  default:
    external:
      name: ffc-sfi
volumes:
  azurite_data: